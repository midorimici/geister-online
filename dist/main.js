(()=>{"use strict";var e={395:e=>{e.exports=require("socket.io")}},n={};function t(r){if(n[r])return n[r].exports;var o=n[r]={exports:{}};return e[r](o,o.exports,t),o.exports}(()=>{const e=require("express"),n=require("http");var r=function(e){var n="function"==typeof Symbol&&Symbol.iterator,t=n&&e[n],r=0;if(t)return t.call(e);if(e&&"number"==typeof e.length)return{next:function(){return e&&r>=e.length&&(e=void 0),{value:e&&e[r++],done:!e}}};throw new TypeError(n?"Object is not iterable.":"Symbol.iterator is not defined.")},o=function(e,n){var t="function"==typeof Symbol&&e[Symbol.iterator];if(!t)return e;var r,o,a=t.call(e),i=[];try{for(;(void 0===n||n-- >0)&&!(r=a.next()).done;)i.push(r.value)}catch(e){o={error:e}}finally{try{r&&!r.done&&(t=a.return)&&t.call(a)}finally{if(o)throw o.error}}return i},a=function(){for(var e=[],n=0;n<arguments.length;n++)e=e.concat(o(arguments[n]));return e},i=e();i.use(e.static(process.cwd()+"/public"));var m=n.createServer(i),l=t(395)(m,{cors:{origin:"https://geister-online.netlify.app",methods:["GET","POST"]}});i.get("/",(function(e,n){n.sendFile(process.cwd()+"/public/index.html")}));var p,c,d,u,s,y,f,g=new Map,v=0,w=[{R:0,B:0},{R:0,B:0}],h=function(e,n,t){var i,m,l,p,c=new Map;try{for(var d=r(e),u=d.next();!u.done;u=d.next()){var s=o(u.value,2),y=s[0],f=s[1],g=o(y.split(",").map((function(e){return+e})),2),v=g[0],w=g[1];0===t?c.set(v+","+(w+2),{color:f,turn:0}):c.set(5-v+","+(3-w),{color:f,turn:0})}}catch(e){i={error:e}}finally{try{u&&!u.done&&(m=d.return)&&m.call(d)}finally{if(i)throw i.error}}try{for(var h=r(n),S=h.next();!S.done;S=h.next()){var x=o(S.value,2),I=(y=x[0],f=x[1],o(y.split(",").map((function(e){return+e})),2));v=I[0],w=I[1],0===t?c.set(5-v+","+(3-w),{color:f,turn:1}):c.set(v+","+(w+2),{color:f,turn:1})}}catch(e){l={error:e}}finally{try{S&&!S.done&&(p=h.return)&&p.call(h)}finally{if(l)throw l.error}}return a(c)},S=function(e,n,t,r){return r?4===e[t].B||-1!==n.indexOf("0,-1")||-1!==n.indexOf("5,-1"):4===e[(t+1)%2].R};l.on("connection",(function(e){e.on("enter room",(function(n){e.info=n;var t=g.get(n.roomId);"play"===n.role?t?"waiting opponent"===t.state?(t.player2={id:e.id,name:n.name,turn:0},t.state="waiting placing",e.join(n.roomId),l.to(n.roomId).emit("wait placing"),l.to(t.player1.id).emit("place pieces"),l.to(t.player2.id).emit("place pieces")):e.emit("room full",n.roomId):(g.set(n.roomId,{player1:{id:e.id,name:n.name,turn:0},player2:{id:"",name:"",turn:0},state:"waiting opponent",ready:0}),e.join(n.roomId),e.emit("wait opponent")):t?(e.join(n.roomId),"waiting opponent"===t.state?e.emit("wait opponent"):"waiting placing"===t.state?e.emit("wait placing"):(e.emit("watch",a(d),s.name,y.name,v,w),0!==f&&1!==f||e.emit("tell winner to audience and first",[s.name,y.name][f],a(d),s.name,y.name,w))):e.emit("no room",n.roomId)})),e.on("decided place",(function(n){var t=e.info.roomId,r=new Map(n),o=g.get(t);o.ready=o.ready+1,1===o.ready?(p=r,o.player1.id===e.id?l.to(o.player1.id).emit("wait placing"):l.to(o.player2.id).emit("wait placing")):2===o.ready&&(c=r,o.player1.id===e.id?o.player1.turn=1:o.player2.turn=1,o.state="playing",d=new Map(h(p,c,0)),u=new Map(h(p,c,1)),s=0===o.player1.turn?{name:o.player1.name,id:o.player1.id}:{name:o.player2.name,id:o.player2.id},y=1===o.player1.turn?{name:o.player1.name,id:o.player1.id}:{name:o.player2.name,id:o.player2.id},v=0,w=[{R:0,B:0},{R:0,B:0}],f=void 0,l.to(t).emit("watch",a(d),s.name,y.name,v,w),l.to(s.id).emit("game",a(d),0,!0,s.name,y.name,w),l.to(y.id).emit("game",a(u),1,!1,s.name,y.name,w))})),e.on("move piece",(function(n,t,r){var o=e.info.roomId,i=[d,u][n],m=[d,u][(n+1)%2];i.has(String(r))&&i.get(String(r)).turn!==n&&(w[n][i.get(String(r)).color]+=1),i.set(String(r),i.get(String(t))),i.delete(String(t)),t=t.map((function(e){return 5-e})),r=r.map((function(e){return 5-e})),m.set(String(r),m.get(String(t))),m.delete(String(t)),v=(v+1)%2,S(w,Array.from(i.keys()),n,!0)?f=n:S(w,Array.from(i.keys()),(n+1)%2,!1)&&(f=(n+1)%2),l.to(o).emit("watch",a(d),s.name,y.name,v,w),l.to(s.id).emit("game",a(d),0,0===v,s.name,y.name,w),l.to(y.id).emit("game",a(u),1,1===v,s.name,y.name,w),0!==f&&1!==f||(l.to(o).emit("tell winner to audience and first",[s.name,y.name][f],a(d),s.name,y.name,w),l.to(y.id).emit("tell winner to second",[s.name,y.name][f],a(u),s.name,y.name,w))})),e.on("chat message",(function(n){l.to(e.info.roomId).emit("chat message",n,"play"===e.info.role,e.info.name)})),e.on("disconnect",(function(){var n=e.info;n&&"play"===n.role&&(g.delete(n.roomId),e.to(n.roomId).leave(n.roomId),e.to(n.roomId).emit("player discon",n.name))}))})),m.listen(process.env.PORT||3e3)})()})();