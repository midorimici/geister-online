(()=>{"use strict";var e={395:e=>{e.exports=require("socket.io")}},r={};function n(t){if(r[t])return r[t].exports;var a=r[t]={exports:{}};return e[t](a,a.exports,n),a.exports}(()=>{const e=require("express"),r=require("http");var t=function(e){var r="function"==typeof Symbol&&Symbol.iterator,n=r&&e[r],t=0;if(n)return n.call(e);if(e&&"number"==typeof e.length)return{next:function(){return e&&t>=e.length&&(e=void 0),{value:e&&e[t++],done:!e}}};throw new TypeError(r?"Object is not iterable.":"Symbol.iterator is not defined.")},a=function(e,r){var n="function"==typeof Symbol&&e[Symbol.iterator];if(!n)return e;var t,a,o=n.call(e),i=[];try{for(;(void 0===r||r-- >0)&&!(t=o.next()).done;)i.push(t.value)}catch(e){a={error:e}}finally{try{t&&!t.done&&(n=o.return)&&n.call(o)}finally{if(a)throw a.error}}return i},o=function(){for(var e=[],r=0;r<arguments.length;r++)e=e.concat(a(arguments[r]));return e},i=e();i.use(e.static(process.cwd()+"/public"));var s=r.createServer(i),l=n(395)(s,{cors:{origin:"https://geister-online.netlify.app",methods:["GET","POST"]}});i.get("/",(function(e,r){r.sendFile(process.cwd()+"/public/ja/index.html")}));var p=new Map,c=function(e,r,n){var i,s,l,p,c=new Map;try{for(var m=t(e),d=m.next();!d.done;d=m.next()){var y=a(d.value,2),u=y[0],f=y[1],w=a(u.split(",").map((function(e){return+e})),2),g=w[0],v=w[1];0===n?c.set(g+","+(v+2),{color:f,turn:0}):c.set(5-g+","+(3-v),{color:f,turn:0})}}catch(e){i={error:e}}finally{try{d&&!d.done&&(s=m.return)&&s.call(m)}finally{if(i)throw i.error}}try{for(var b=t(r),h=b.next();!h.done;h=b.next()){var S=a(h.value,2),x=(u=S[0],f=S[1],a(u.split(",").map((function(e){return+e})),2));g=x[0],v=x[1],0===n?c.set(5-g+","+(3-v),{color:f,turn:1}):c.set(g+","+(v+2),{color:f,turn:1})}}catch(e){l={error:e}}finally{try{h&&!h.done&&(p=b.return)&&p.call(b)}finally{if(l)throw l.error}}return o(c)},m=function(e,r,n,t){return t?4===e[n].B||-1!==r.indexOf("0,-1")||-1!==r.indexOf("5,-1"):4===e[(n+1)%2].R};l.on("connection",(function(e){e.on("enter room",(function(r){e.info=r;var n=p.get(r.roomId);"play"===r.role?n?"waiting opponent"===n.state?(n.players[1]={id:e.id,name:r.name},n.state="waiting placing",e.join(r.roomId),l.to(r.roomId).emit("wait placing"),l.to(n.players[0].id).emit("place pieces"),l.to(n.players[1].id).emit("place pieces")):(e.emit("room full",r.roomId),e.info.role="watch"):(p.set(r.roomId,{players:[{id:e.id,name:r.name},{id:"",name:""}],state:"waiting opponent",ready:0,orders:[new Map,new Map],boards:[new Map,new Map],curTurn:0,takenPieces:[{R:0,B:0},{R:0,B:0}],winner:null}),e.join(r.roomId),e.emit("wait opponent")):n?(e.join(r.roomId),"waiting opponent"===n.state?e.emit("wait opponent"):"waiting placing"===n.state?e.emit("wait placing"):(e.emit("watch",o(n.boards[0]),n.players[0].name,n.players[1].name,n.curTurn,n.takenPieces),0!==n.winner&&1!==n.winner||e.emit("tell winner to audience and first",[n.players[0].name,n.players[1].name][n.winner],o(n.boards[0]),n.players[0].name,n.players[1].name,n.takenPieces))):e.emit("no room",r.roomId)})),e.on("decided place",(function(r){var n=e.info.roomId,t=new Map(r),a=p.get(n);a.ready=a.ready+1,1===a.ready?(a.orders[0]=t,a.players[0].id===e.id?l.to(a.players[0].id).emit("wait placing"):l.to(a.players[1].id).emit("wait placing")):2===a.ready&&(a.orders[1]=t,a.players[0].id===e.id&&a.players.reverse(),a.state="playing",a.boards[0]=new Map(c(a.orders[0],a.orders[1],0)),a.boards[1]=new Map(c(a.orders[0],a.orders[1],1)),l.to(n).emit("watch",o(a.boards[0]),a.players[0].name,a.players[1].name,a.curTurn,a.takenPieces),l.to(a.players[0].id).emit("game",o(a.boards[0]),0,!0,a.players[0].name,a.players[1].name,a.takenPieces),l.to(a.players[1].id).emit("game",o(a.boards[1]),1,!1,a.players[0].name,a.players[1].name,a.takenPieces))})),e.on("move piece",(function(r,n,t){var a=e.info.roomId,i=p.get(a),s=[i.boards[0],i.boards[1]][r],c=[i.boards[0],i.boards[1]][(r+1)%2];s.has(String(t))&&s.get(String(t)).turn!==r&&(i.takenPieces[r][s.get(String(t)).color]+=1);var d=i.takenPieces;s.set(String(t),s.get(String(n))),s.delete(String(n)),n=n.map((function(e){return 5-e})),t=t.map((function(e){return 5-e})),c.set(String(t),c.get(String(n))),c.delete(String(n)),i.curTurn=(i.curTurn+1)%2,m(d,Array.from(s.keys()),r,!0)?i.winner=r:m(d,Array.from(s.keys()),(r+1)%2,!1)&&(i.winner=(r+1)%2);var y=i.winner;l.to(a).emit("watch",o(i.boards[0]),i.players[0].name,i.players[1].name,i.curTurn,d),l.to(i.players[0].id).emit("game",o(i.boards[0]),0,0===i.curTurn,i.players[0].name,i.players[1].name,d),l.to(i.players[1].id).emit("game",o(i.boards[1]),1,1===i.curTurn,i.players[0].name,i.players[1].name,d),0!==y&&1!==y||(l.to(a).emit("tell winner to audience and first",[i.players[0].name,i.players[1].name][y],o(i.boards[0]),i.players[0].name,i.players[1].name,d),l.to(i.players[1].id).emit("tell winner to second",[i.players[0].name,i.players[1].name][y],o(i.boards[1]),i.players[0].name,i.players[1].name,d))})),e.on("chat message",(function(r){l.to(e.info.roomId).emit("chat message",r,"play"===e.info.role,e.info.name)})),e.on("disconnect",(function(){var r=e.info;r&&"play"===r.role&&(p.delete(r.roomId),e.to(r.roomId).leave(r.roomId),e.to(r.roomId).emit("player discon",r.name))}))})),s.listen(process.env.PORT||3e3)})()})();